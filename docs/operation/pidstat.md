# pidstat命令


### 1.介绍

pidstat是sysstat工具的一个命令，用于监控全部或指定进程的cpu、内存、线程、设备IO等系统资源的占用情况，linux系统如果没有这个指令则需要安装sysstat。


pidstat首次运行时显示自系统启动开始的各项统计信息，之后运行pidstat将显示自上次运行该命令以后的统计信息。用户可以通过指定统计的次数和时间来获得所需的统计信息。

### 2.命令参数

|参数|含义|
|-|-|
-u|默认的参数，显示各个进程的cpu使用统计
-r|显示各个进程的内存使用统计
-d|显示各个进程的IO使用情况
-p|指定进程号
-w|显示每个进程的上下文切换情况
-t|显示选择任务的线程的统计信息外的额外信息
-T { TASK | CHILD | ALL }|这个选项指定了pidstat监控的。TASK表示报告独立的task，CHILD关键字表示报告进程下所有线程统计信息。ALL表示报告独立的task和task下面的所有线程。注意：task和子线程的全局的统计信息和pidstat选项无关。这些统计信息不会对应到当前的统计间隔，这些统计信息只有在子线程kill或者完成的时候才会被收集。
-V|版本号
-h|在一行上显示了所有活动，这样其他程序可以容易解析。
-I|在SMP环境，表示任务的CPU使用率/内核数量
-l|显示命令名和所有参数

### 3.使用实例

#### 1.查看所有进程的  CPU 使用情况

在测试服务上执行:

```
[root@node14 ~]# pidstat -u -p ALL
```

可以看到以下输出:

```
Linux 3.10.0-1160.25.1.el7_lustre.x86_64 (node13.domain.cn)     12/29/2021      _x86_64_        (48 CPU)

01:47:35 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command
01:47:35 PM     0         1    0.01    0.01    0.00    0.02    21  systemd
01:47:35 PM     0         2    0.00    0.00    0.00    0.00    14  kthreadd
01:47:35 PM     0         4    0.00    0.00    0.00    0.00     0  kworker/0:0H
01:47:35 PM     0         5    0.00    0.00    0.00    0.00    21  kworker/u96:0
01:47:35 PM     0         6    0.00    0.00    0.00    0.00     0  ksoftirqd/0
01:47:35 PM     0         7    0.00    0.00    0.00    0.00     0  migration/0
01:47:35 PM     0         8    0.00    0.00    0.00    0.00     0  rcu_bh
01:47:35 PM     0         9    0.00    0.01    0.00    0.01    37  rcu_sched
01:47:35 PM     0        10    0.00    0.00    0.00    0.00     0  lru-add-drain
01:47:35 PM     0        11    0.00    0.00    0.00    0.00     0  watchdog/0
01:47:35 PM     0        12    0.00    0.00    0.00    0.00     1  watchdog/1
01:47:35 PM     0        13    0.00    0.00    0.00    0.00     1  migration/1
01:47:35 PM     0        14    0.00    0.00    0.00    0.00     1  ksoftirqd/1
01:47:35 PM     0        16    0.00    0.00    0.00    0.00     1  kworker/1:0H
01:47:35 PM     0        17    0.00    0.00    0.00    0.00     9  kworker/u97:0
01:47:35 PM     0        18    0.00    0.00    0.00    0.00     2  watchdog/2
01:47:35 PM     0        19    0.00    0.00    0.00    0.00     2  migration/2
01:47:35 PM     0        20    0.00    0.00    0.00    0.00     2  ksoftirqd/2

```

#### 输出说明

|信息|含义|
|-| -|
PID|进程ID
%usr|进程在用户空间占用cpu的百分比
%system|进程在内核空间占用cpu的百分比
%guest|进程在虚拟机占用cpu的百分比
%CPU|进程占用cpu的百分比
CPU|处理进程的cpu编号
Command|当前进程对应的命令

#### 2.内存使用情况统计

在测试服务上执行:

```
[root@node14 ~]# pidstat -r
```

可以看到以下输出:

```
Linux 3.10.0-1160.25.1.el7_lustre.x86_64 (node13.domain.cn)     12/29/2021      _x86_64_        (48 CPU)

01:55:23 PM   UID       PID  minflt/s  majflt/s     VSZ    RSS   %MEM  Command
01:55:23 PM     0         1      0.61      0.00   51824   4068   0.00  systemd
01:55:23 PM     0       903      0.92      0.00  174388 101368   0.10  systemd-journal
01:55:23 PM     0       918      0.00      0.00  272304   3468   0.00  lvmetad
01:55:23 PM     0       954      0.00      0.00   45592   2440   0.00  systemd-udevd
01:55:23 PM     0      1297      0.00      0.00   55532   1088   0.00  auditd
01:55:23 PM     0      1333      0.00      0.00   90568   3268   0.00  rngd
01:55:23 PM    81      1358      0.01      0.00   58232   2400   0.00  dbus-daemon
01:55:23 PM     0      1374      1.40      0.00   21936   1540   0.00  irqbalance
01:55:23 PM    32      1390      0.00      0.00   69280   1004   0.00  rpcbind
01:55:23 PM     0      1396      0.16      0.00   26384   1784   0.00  systemd-logind
01:55:23 PM   999      1404      0.00      0.00  612248  11248   0.01  polkitd
01:55:23 PM    38      1569      0.00      0.00   25732   1968   0.00  ntpd
01:55:23 PM     0      1570      0.00      0.00  201428   1260   0.00  gssproxy
01:55:23 PM     0      1580      0.00      0.00   25908    944   0.00  atd
01:55:23 PM     0      1581      0.20      0.00  126388   1608   0.00  crond
01:55:23 PM     0      1586      0.00      0.00  110204    848   0.00  agetty
01:55:23 PM     0      1671      0.00      0.00  112924   4380   0.00  sshd
01:55:23 PM     0      1672      0.01      0.00  574296  17548   0.02  tuned

```

#### 输出说明

|信息|含义|
|-| -|
PID|进程标识符
Minflt/s|任务每秒发生的次要错误，不需要从磁盘中加载页
Majflt/s|任务每秒发生的主要错误，需要从磁盘中加载页
VSZ|虚拟地址大小，虚拟内存的使用KB
RSS|常驻集合大小，非交换区五里内存使用KB
Command|task命令名

#### 3.显示各个进程的IO使用情况

在测试服务上执行:

```
[root@node14 ~]# pidstat -d
```

可以看到以下输出:

```
Linux 3.10.0-1160.25.1.el7_lustre.x86_64 (node13.domain.cn)     12/29/2021      _x86_64_        (48 CPU)

01:57:32 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command
01:57:32 PM     0         1      0.16      0.22      0.08  systemd
01:57:32 PM     0        17      0.00      0.00      0.00  kworker/u97:0
01:57:32 PM     0       780      0.00      0.00      0.00  kworker/u97:2
01:57:32 PM     0       818      0.00      0.00      0.00  xfsaild/dm-0
01:57:32 PM     0       903      0.00      0.00      0.00  systemd-journal
01:57:32 PM     0       954      0.00      0.00      0.00  systemd-udevd
01:57:32 PM     0      1297      0.00      0.06      0.00  auditd
01:57:32 PM     0      1333      0.00      0.00      0.00  rngd
01:57:32 PM   999      1404      0.00      0.00      0.00  polkitd
01:57:32 PM    38      1569      0.00      0.00      0.00  ntpd
01:57:32 PM     0      1570      0.00      0.00      0.00  gssproxy
01:57:32 PM     0      1581      0.00      0.05      0.00  crond
01:57:32 PM     0      1671      0.00      0.00      0.00  sshd
01:57:32 PM     0      1672      0.00      0.00      0.00  tuned
01:57:32 PM     0      1674      0.00      0.00      0.00  condor_master
```

#### 输出说明

|信息|含义|
|-| -|
PID|进程id
kB_rd/s|每秒从磁盘读取的KB
kB_wr/s|每秒写入磁盘KB
kB_ccwr/s|任务取消的写入磁盘的KB。当任务截断脏的pagecache的时候会发生。
COMMAND|task的命令名


#### 4.显示每个进程的上下文切换情况

在测试服务上执行:

```
[root@node14 ~]# pidstat -w
```

可以看到以下输出:

```
Linux 3.10.0-1160.25.1.el7_lustre.x86_64 (node13.domain.cn)     12/29/2021      _x86_64_        (48 CPU)

01:58:37 PM   UID       PID   cswch/s nvcswch/s  Command
01:58:37 PM     0         1      1.18      0.04  systemd
01:58:37 PM     0         2      0.01      0.00  kthreadd
01:58:37 PM     0         4      0.00      0.00  kworker/0:0H
01:58:37 PM     0         5      0.00      0.00  kworker/u96:0
01:58:37 PM     0         6      0.50      0.00  ksoftirqd/0
01:58:37 PM     0         7      0.00      0.00  migration/0
01:58:37 PM     0         8      0.00      0.00  rcu_bh
01:58:37 PM     0         9      4.75      0.00  rcu_sched
01:58:37 PM     0        10      0.00      0.00  lru-add-drain
01:58:37 PM     0        11      0.25      0.00  watchdog/0
01:58:37 PM     0        12      0.25      0.00  watchdog/1
01:58:37 PM     0        13      0.00      0.00  migration/1
01:58:37 PM     0        14      0.00      0.00  ksoftirqd/1
01:58:37 PM     0        16      0.00      0.00  kworker/1:0H

```

#### 输出说明

|信息|含义|
|-| -|
PID|进程id
Cswch/s|每秒主动任务上下文切换数量
Nvcswch/s|每秒被动任务上下文切换数量
Command|命令名

#### 5.显示选择任务的线程的统计信息外的额外信息

在测试服务上执行:

```
[root@node14 ~]# pidstat -t
```

可以看到以下输出:

```
Linux 3.10.0-1160.25.1.el7_lustre.x86_64 (node13.domain.cn)     12/29/2021      _x86_64_        (48 CPU)

02:01:09 PM   UID      TGID       TID    %usr %system  %guest    %CPU   CPU  Command
02:01:09 PM     0         1         -    0.01    0.01    0.00    0.02    21  systemd
02:01:09 PM     0         -         1    0.01    0.01    0.00    0.01    21  |__systemd
02:01:09 PM     0         2         -    0.00    0.00    0.00    0.00    14  kthreadd
02:01:09 PM     0         -         2    0.00    0.00    0.00    0.00    14  |__kthreadd
02:01:09 PM     0         5         -    0.00    0.00    0.00    0.00    21  kworker/u96:0
02:01:09 PM     0         -         5    0.00    0.00    0.00    0.00    21  |__kworker/u96:0
02:01:09 PM     0         6         -    0.00    0.00    0.00    0.00     0  ksoftirqd/0
02:01:09 PM     0         -         6    0.00    0.00    0.00    0.00     0  |__ksoftirqd/0
02:01:09 PM     0         7         -    0.00    0.00    0.00    0.00     0  migration/0
02:01:09 PM     0         -         7    0.00    0.00    0.00    0.00     0  |__migration/0
02:01:09 PM     0         9         -    0.00    0.01    0.00    0.01    11  rcu_sched
02:01:09 PM     0         -         9    0.00    0.01    0.00    0.01    11  |__rcu_sched
02:01:09 PM     0        11         -    0.00    0.00    0.00    0.00     0  watchdog/0
02:01:09 PM     0         -        11    0.00    0.00    0.00    0.00     0  |__watchdog/0
02:01:09 PM     0        12         -    0.00    0.00    0.00    0.00     1  watchdog/1
02:01:09 PM     0         -        12    0.00    0.00    0.00    0.00     1  |__watchdog/1
02:01:09 PM     0        13         -    0.00    0.00    0.00    0.00     1  migration/1

```

#### 输出说明

|信息|含义|
|-| -|
TGID|主线程的表示
TID|线程id
%usr|进程在用户空间占用cpu的百分比
%system|进程在内核空间占用cpu的百分比
%guest|进程在虚拟机占用cpu的百分比
%CPU|进程占用cpu的百分比
CPU|处理进程的cpu编号
Command|当前进程对应的命令

实例1：显示所有设备负载情况