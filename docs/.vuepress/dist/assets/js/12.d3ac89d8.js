(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{385:function(s,e,t){"use strict";t.r(e);var a=t(46),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"安装与测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装与测试"}},[s._v("#")]),s._v(" 安装与测试")]),s._v(" "),t("h3",{attrs:{id:"_1-做好节点准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-做好节点准备工作"}},[s._v("#")]),s._v(" 1.做好节点准备工作")]),s._v(" "),t("p",[s._v("要安装的Lustre按以下架构划分节点，并且要把下面内容添加到节点的 /etc/hosts文件中，均小写。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("127.0.0.1   localhost localhost.localdomain\n\n192.168.10.13 client\n192.168.10.14 MGS MDS\n192.168.10.15 OSS1\n192.168.10.16 OSS2\n")])])]),t("h4",{attrs:{id:"注意-要更新所有节点的-etc-hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意-要更新所有节点的-etc-hosts"}},[s._v("#")]),s._v(" 注意：要更新所有节点的 /etc/hosts")]),s._v(" "),t("p",[s._v("接下来安装EPEL 和ZFS 仓库，以及Chrony")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum -y install epel-release\nrpm -ivh http://download.zfsonlinux.org/epel/zfs-release.el7.centos.noarch.rpm\nyum -y install chrony\nsystemctl start chronyd\nsystemctl enable chronyd\n")])])]),t("h4",{attrs:{id:"注意所有节点时间要正确-如果有必要可以设置时区。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意所有节点时间要正确-如果有必要可以设置时区。"}},[s._v("#")]),s._v(" 注意所有节点时间要正确，如果有必要可以设置时区。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("timedatectl set-timezone Asia/Tokyo\n")])])]),t("p",[s._v("建立Lustre配置文件 /etc/yum.repos.d/lustre.repo，加入以下内容：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[lustre-server]\nname=CentOS-$releasever - Lustre\nbaseurl=https://downloads.hpdd.intel.com/public/lustre/latest-feature-release/el7/server/\ngpgcheck=0\n\n[e2fsprogs]\nname=CentOS-$releasever - Ldiskfs\nbaseurl=https://downloads.hpdd.intel.com/public/e2fsprogs/latest/el7/\ngpgcheck=0\n\n[lustre-client]\nname=CentOS-$releasever - Lustre\nbaseurl=https://downloads.hpdd.intel.com/public/lustre/latest-feature-release/el7/client/\ngpgcheck=0\n\n")])])]),t("p",[s._v("在所有节点安装最新版本的Lustre内核以及客户端，")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum -y install e2fsprogs \\\n    lustre-client \\\n    kernel-3.10.0-514.21.1.el7_lustre.x86_64 \\\n    kernel-devel-3.10.0-514.21.1.el7_lustre.x86_64 \\\n    kernel-headers-3.10.0-514.21.1.el7_lustre.x86_64\n")])])]),t("p",[s._v("最后需要重启所有节点来支持使用Lustre内核。")]),s._v(" "),t("h3",{attrs:{id:"_2-安装lnet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装lnet"}},[s._v("#")]),s._v(" 2.安装Lnet")]),s._v(" "),t("p",[s._v("建立Lnet的modprobe配置文件/etc/modprobe.d/let.conf 以及网络参数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("options lnet networks=tcp0(eth0)\n")])])]),t("p",[s._v("手动加载modprobe模块")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("modprobe lnet\n")])])]),t("p",[s._v("确认modprobe模块已经加载")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("lsmod | grep lnet\n")])])]),t("p",[s._v("为了启动时自动加载lnet modprobe模块，建立/etc/sysconfig/modules/lnet.modules 并且加入以下内容：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#!/bin/sh\n\nif [ ! -c /dev/lnet ] ; then\n    exec /sbin/modprobe lnet >/dev/null 2>&1\nfi\n")])])]),t("h3",{attrs:{id:"_2-客户端加载lustre"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-客户端加载lustre"}},[s._v("#")]),s._v(" 2.客户端加载Lustre")]),s._v(" "),t("p",[s._v("加载lustre内核模块")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("modprobe lustre\n")])])]),t("p",[s._v("检查内核模块是否加载")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("lsmod |grep lustre\n")])])]),t("p",[s._v("为了启动时自动加载lustre modprobe模块，建立/etc/sysconfig/modules/lustre.modules 并且加入以下内容：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#!/bin/sh\n\n/sbin/lsmod | /bin/grep lustre 1>/dev/null 2>&1\nif [ ! $? ] ; then\n   /sbin/modprobe lustre >/dev/null 2>&1\nfi\n")])])]),t("h3",{attrs:{id:"_3-创建lustre文件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建lustre文件系统"}},[s._v("#")]),s._v(" 3.创建Lustre文件系统")]),s._v(" "),t("h4",{attrs:{id:"创建mgt-on-mgs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建mgt-on-mgs"}},[s._v("#")]),s._v(" 创建MGT on MGS")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ssh root@mgs\nmkfs.lustre --mgs /dev/xvdb\nmkdir /mgt\nmount.lustre /dev/xvdb /mgt\n")])])]),t("h4",{attrs:{id:"创建-mdt-on-mds"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-mdt-on-mds"}},[s._v("#")]),s._v(" 创建 MDT on MDS")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ssh root@mds\nmkfs.lustre --fsname=lustrefs --mgsnode=mgs@tcp0 \\\n    --mdt --index=0 /dev/xvdb\nmkdir /mdt\nmount.lustre /dev/xvdb /mdt\n")])])]),t("h4",{attrs:{id:"创建ost-1和ost-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建ost-1和ost-2"}},[s._v("#")]),s._v(" 创建OST 1和OST 2")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ssh root@oss1\nmkfs.lustre --ost --fsname=lustrefs --mgsnode=mgs@tcp0 \\\n    --index=1 /dev/xvdb\nmkfs.lustre --ost --fsname=lustrefs --mgsnode=mgs@tcp0 \\\n    --index=2 /dev/xvdc\nmkdir /ost1\nmkdir /ost2\nmount.lustre /dev/xvdb /ost1\nmount.lustre /dev/xvdc /ost2\n")])])]),t("h4",{attrs:{id:"挂在lustre客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂在lustre客户端"}},[s._v("#")]),s._v(" 挂在lustre客户端")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mkdir /lustrefs\nmount -t lustre mgs@tcp0:/lustrefs /lustrefs\n")])])]),t("h3",{attrs:{id:"_4-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-测试"}},[s._v("#")]),s._v(" 4.测试")]),s._v(" "),t("p",[s._v("从客户端上可以查看Lustre安装状态并做测试")]),s._v(" "),t("p",[s._v("查看 /lustrefs")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("df -h /lustrefs\nFilesystem                   Size  Used Avail Use% Mounted on\n172.31.42.130@tcp:/lustrefs   56G  223M   53G   1% /lustrefs\n")])])]),t("p",[s._v("查看服务端")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("lfs check servers\nlustrefs-MDT0000-mdc-ffff88003bfbd000 active.\nlustrefs-OST0001-osc-ffff88003bfbd000 active.\nlustrefs-OST0002-osc-ffff88003bfbd000 active.\nlustrefs-OST0003-osc-ffff88003bfbd000 active.\nlustrefs-OST0004-osc-ffff88003bfbd000 active.\nlustrefs-OST0005-osc-ffff88003bfbd000 active.\nlustrefs-OST0006-osc-ffff88003bfbd000 active.\n")])])]),t("p",[s._v("查看文件系统")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("lfs df -h\nUUID                       bytes        Used   Available Use% Mounted on\nlustrefs-MDT0000_UUID        5.6G       45.8M        5.0G   1% /lustrefs[MDT:0]\nlustrefs-OST0001_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:1]\nlustrefs-OST0002_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:2]\nlustrefs-OST0003_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:3]\nlustrefs-OST0004_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:4]\nlustrefs-OST0005_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:5]\nlustrefs-OST0006_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:6]\n\nfilesystem_summary:        55.3G      222.9M       52.0G   0% /lustrefs\n")])])]),t("p",[s._v("如果以上没有问题，可以做一个快速测试")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@client ~]# for aa in {1..5}; do dd if=/dev/zero of=/lustrefs/file$aa bs=4k iflag=fullblock,count_bytes count=1G; done\n[root@client ~]# df -h /lustrefs\nFilesystem                   Size  Used Avail Use% Mounted on\n172.31.42.130@tcp:/lustrefs   56G  5.3G   47G  10% /lustrefs\n[root@client ~]# lfs df -h\nUUID                       bytes        Used   Available Use% Mounted on\nlustrefs-MDT0000_UUID        5.6G       45.8M        5.0G   1% /lustrefs[MDT:0]\nlustrefs-OST0001_UUID        9.2G        1.0G        7.7G  12% /lustrefs[OST:1]\nlustrefs-OST0002_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:2]\nlustrefs-OST0003_UUID        9.2G        2.0G        6.6G  23% /lustrefs[OST:3]\nlustrefs-OST0004_UUID        9.2G        1.0G        7.7G  12% /lustrefs[OST:4]\nlustrefs-OST0005_UUID        9.2G       37.1M        8.7G   0% /lustrefs[OST:5]\nlustrefs-OST0006_UUID        9.2G        1.0G        7.6G  12% /lustrefs[OST:6]\n")])])]),t("h4",{attrs:{id:"注意-以上安装方式没有组raid-需要的话要选择zfs或者硬件提供。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意-以上安装方式没有组raid-需要的话要选择zfs或者硬件提供。"}},[s._v("#")]),s._v(" 注意：以上安装方式没有组RAID，需要的话要选择ZFS或者硬件提供。")])])}),[],!1,null,null,null);e.default=r.exports}}]);